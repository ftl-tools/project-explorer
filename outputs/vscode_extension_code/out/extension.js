"use strict";var G=Object.create;var R=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var ee=(a,e)=>{for(var n in e)R(a,n,{get:e[n],enumerable:!0})},J=(a,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of X(e))!q.call(a,r)&&r!==n&&R(a,r,{get:()=>e[r],enumerable:!(o=Q(e,r))||o.enumerable});return a};var T=(a,e,n)=>(n=a!=null?G(Y(a)):{},J(e||!a||!a.__esModule?R(n,"default",{value:a,enumerable:!0}):n,a)),te=a=>J(R({},"__esModule",{value:!0}),a);var le={};ee(le,{activate:()=>ae,deactivate:()=>de});module.exports=te(le);var l=T(require("vscode"));var h=T(require("vscode")),C=T(require("path")),b=T(require("fs")),ne=T(require("https")),se=T(require("http")),H=require("child_process"),N=class{constructor(e){this.context=e;this.inflight=new Map;this.cacheDir=C.join(e.globalStorageUri.fsPath,"favicons"),this.indexPath=C.join(this.cacheDir,"index.json");try{b.mkdirSync(this.cacheDir,{recursive:!0})}catch{}this.index=this.readIndex()}async getIconForUrl(e){let n;try{let d=new URL(e);if(d.protocol!=="http:"&&d.protocol!=="https:")return;n=`${d.protocol}//${d.host}`}catch{return}let o=this.inflight.get(n);if(o)return o;let r=this.resolve(n,e).finally(()=>this.inflight.delete(n));return this.inflight.set(n,r),r}async resolve(e,n){let o=Date.now(),r=this.index[e];if(r){if(r.expiresAt&&r.expiresAt>o&&r.path&&b.existsSync(r.path))return h.Uri.file(r.path);if(r.negativeUntil&&r.negativeUntil>o)return}let d=`${e}/favicon.ico`,f=await this.tryFetchBuffer(d,5e3).catch(()=>{});if(f){let t=this.saveIcon(e,f,"ico");return this.index[e]={path:t,expiresAt:o+7*24*60*60*1e3},this.writeIndex(),h.Uri.file(t)}let g=await this.tryFetchText(n,5e3).catch(()=>{});if(g){let t=this.findIconHref(g);if(t)try{let s=new URL(n),c=new URL(t,s),u=await this.tryFetchBuffer(c.toString(),7e3).catch(()=>{});if(u){let y=this.guessExtFromUrlOrMime(c.toString()),m=this.saveIcon(e,u,y);return this.index[e]={path:m,expiresAt:o+7*24*60*60*1e3},this.writeIndex(),h.Uri.file(m)}}catch{}}this.index[e]={negativeUntil:o+24*60*60*1e3},this.writeIndex()}readIndex(){try{if(b.existsSync(this.indexPath)){let e=b.readFileSync(this.indexPath,"utf8");return JSON.parse(e)||{}}}catch{}return{}}writeIndex(){try{b.writeFileSync(this.indexPath,JSON.stringify(this.index,null,2),"utf8")}catch{}}saveIcon(e,n,o){let r=e.replace(/[^a-z0-9]/gi,"_"),d=C.join(this.cacheDir,`${r}.${o}`);return b.writeFileSync(d,n),d}guessExtFromUrlOrMime(e){let n=e.toLowerCase();return n.endsWith(".png")?"png":n.endsWith(".svg")||n.includes("image/svg")?"svg":n.endsWith(".jpg")||n.endsWith(".jpeg")?"jpg":n.endsWith(".ico")?"ico":"png"}async tryFetchText(e,n){return(await this.tryFetchBuffer(e,n)).toString("utf8")}async tryFetchBuffer(e,n){return new Promise((o,r)=>{let d=!1,f=setTimeout(()=>{d=!0,s==null||s.destroy(new Error("timeout")),r(new Error("timeout"))},n),s=(new URL(e).protocol==="https:"?ne:se).get(e,c=>{let u=c.statusCode||0;if([301,302,303,307,308].includes(u)&&c.headers.location){clearTimeout(f),this.tryFetchBuffer(new URL(c.headers.location,e).toString(),n).then(o,r),c.resume();return}if(u<200||u>=300){clearTimeout(f),r(new Error(`HTTP ${u}`)),c.resume();return}let y=[];c.on("data",m=>y.push(Buffer.isBuffer(m)?m:Buffer.from(m))),c.on("end",()=>{d||(clearTimeout(f),o(Buffer.concat(y)))}),c.on("error",m=>{d||(clearTimeout(f),r(m))})});s.on("error",c=>{d||(clearTimeout(f),r(c))})})}findIconHref(e){let n=/<link\s+[^>]*rel=["']([^"']*)["'][^>]*href=["']([^"']+)["'][^>]*>/gi,o,r=[];for(;o=n.exec(e);){let d=o[1].toLowerCase(),f=o[2];d.includes("icon")&&r.push(f)}return r[0]}},L=class{constructor(e){this._onDidChangeTreeData=new h.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.items=new Map;this.treeFileUri=null;this.watcher=null;this.parentById=new Map;this.childrenById=new Map;this.roots=[];this.running=new Set;this.scriptIds=new Set;var o;this.favicons=new N(e);let n=(o=h.workspace.workspaceFolders)==null?void 0:o[0];if(n){this.treeFileUri=h.Uri.joinPath(n.uri,".vscode","project_explorer","tree_items.json");let r=new h.RelativePattern(n,".vscode/project_explorer/tree_items.json");this.watcher=h.workspace.createFileSystemWatcher(r),this.watcher.onDidChange(()=>this.refresh()),this.watcher.onDidCreate(()=>this.refresh())}h.workspace.onDidChangeConfiguration(r=>{(r.affectsConfiguration("project-explorer.treeItems")||r.affectsConfiguration("project-explorer"))&&this.refresh()})}refresh(){this.rebuild(),this._onDidChangeTreeData.fire()}retheme(){let e=C.join(__dirname,"..","resources","icons");for(let[n,o]of this.items){let r=o.iconPath;if(r&&typeof r=="object"&&"light"in r&&"dark"in r){let d=String(r.light),f=String(r.dark);if(d.includes("resources/icons")&&f.includes("resources/icons")){let g=d.match(/([^/\\]+)\.light_mode\.(png|svg)$/);if(g){let t=g[1],s=this.resolveProjectExplorerIcon(t);s&&(o.iconPath=s)}}}}this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){return this.items.size===0&&this.roots.length===0&&this.rebuild(),e?(this.childrenById.get(e.id||"")||[]).map(o=>this.items.get(o)).filter(Boolean):this.roots.map(o=>this.items.get(o)).filter(Boolean)}rebuild(){let e=new Set;this.items.clear(),this.parentById.clear(),this.childrenById.clear(),this.roots=[],this.scriptIds.clear();let n=this.readTreeItemsFromFile(),o=[];for(let t of n){if(!t||typeof t!="object"){e.add("Ignored non-object entry in `project-explorer.treeItems`.");continue}let s=typeof t.id=="string"&&t.id.trim()?t.id.trim():"",c=typeof t.typeAndPath=="string"?t.typeAndPath:void 0;if(!s){e.add("Ignored item with missing `id`.");continue}if(this.items.has(s)||o.find(P=>P.id===s)){e.add(`Duplicate id '${s}' found. Only the first occurrence will be used.`);continue}let u=typeof t.parentId=="string"&&t.parentId.trim()?t.parentId.trim():void 0,y=typeof t.label=="string"&&t.label.trim()?t.label.trim():void 0,m=typeof t.icon=="string"&&t.icon.trim()?t.icon.trim():void 0,p,v,j=c,w=t.type_plus_path,i=typeof j=="string"&&j.trim()?j.trim():typeof w=="string"&&w.trim()?w.trim():"";if(!i&&typeof w=="string"&&w.trim()&&e.add(`Item '${s}' uses deprecated 'type_plus_path'. Please rename to 'typeAndPath'.`),i){let P=i.indexOf(":");if(P>0&&P<i.length-1){let S=i.slice(0,P),k=i.slice(P+1);["file","folder","url","script"].includes(S)?(p=S,v=k):e.add(`Item '${s}' has unknown type '${S}'. Treating as label-only item.`)}else e.add(`Item '${s}' has invalid typeAndPath '${i}'. Treating as label-only item.`)}let I=y;if(!I)if(p&&v)if(p==="url")try{let P=new URL(v),S=P.pathname.split("/").filter(Boolean);I=S.length>0?decodeURIComponent(S[S.length-1]):P.hostname}catch{I=v}else p==="file"||p==="folder"?I=C.basename(this.resolveFsPath(v)):p==="script"&&(I=v);else I=s;let x={id:s,type:p,target:v,label:I,icon:m,parentId:u??void 0};if(p==="script"){let P=typeof t.cwd=="string"&&t.cwd.trim()?t.cwd.trim():void 0,S=t.env,k;if(S&&typeof S=="object"&&!Array.isArray(S)){k={};for(let[B,E]of Object.entries(S))typeof E=="string"&&(k[B]=E)}x.cwd=P,x.env=k,this.scriptIds.add(s)}let A=t.additionalContextMenuItems;if(A&&typeof A=="object"&&!Array.isArray(A)){let P={};for(let[S,k]of Object.entries(A))typeof k=="string"&&k.trim()&&(P[S]=k.trim());Object.keys(P).length>0&&(x.additionalContextMenuItems=P)}o.push(x)}for(let t of o){let s=this.makeNode(t);this.items.set(t.id,s),this.parentById.set(t.id,t.parentId||void 0)}for(let[t,s]of Array.from(this.parentById.entries()))s&&this.scriptIds.has(s)&&(e.add(`Item '${t}' cannot have script parent '${s}'. Rendering as top-level.`),this.parentById.set(t,void 0));let r=new Set,d=new Set,f=new Set,g=t=>{if(d.has(t)){f.add(t);return}if(r.has(t))return;r.add(t),d.add(t);let s=this.parentById.get(t);s&&this.items.has(s)&&g(s),d.delete(t)};for(let t of this.items.keys())g(t);f.size>0&&e.add("Detected cyclical parent relationships. Items in cycles will be rendered at top level.");for(let t of f)this.parentById.delete(t);for(let t of this.items.keys())this.childrenById.set(t,[]);for(let[t,s]of this.parentById)s&&this.items.has(s)&&this.childrenById.get(s).push(t);for(let t of this.items.keys()){let s=this.parentById.get(t);(!s||!this.items.has(s))&&(s&&!this.items.has(s)&&e.add(`Parent '${s}' not found for item '${t}'. Rendering as top-level.`),this.roots.push(t))}for(let[t,s]of this.items){let c=(this.childrenById.get(t)||[]).length>0;s.collapsibleState=c?h.TreeItemCollapsibleState.Collapsed:h.TreeItemCollapsibleState.None}e.size>0&&h.window.showWarningMessage(Array.from(e).join(" "))}makeNode(e){let{id:n}=e,o=e.type,r=e.target,d=e.label,f,g=new h.MarkdownString;if(o&&r?g.appendText(`${o}:${r}`):g.appendText(d),g.isTrusted=!0,e.icon){let s=this.parseCodicon(e.icon);if(s)f=new h.ThemeIcon(s);else if(e.icon.startsWith("projectExplorer:")){let c=e.icon.substring(16),u=this.resolveProjectExplorerIcon(c);u?f=u:h.window.showWarningMessage(`Project Explorer icon not found: ${c}. Falling back to default icon.`)}else if(e.icon.startsWith("local:")){let c=e.icon.substring(6),u=this.resolveFsPath(c);b.existsSync(u)?f=h.Uri.file(u):h.window.showWarningMessage(`Local icon not found for item '${n}': ${c}. Falling back to default icon.`)}else if(e.icon.startsWith("vscode:")){let c=e.icon.substring(7);f=new h.ThemeIcon(c)}else if(e.icon.startsWith("remote:")){let c=e.icon.substring(7);this.fetchRemoteIcon(c,n).catch(()=>{})}else{let c=this.resolveFsPath(e.icon);b.existsSync(c)?f=h.Uri.file(c):h.window.showWarningMessage(`Icon path not found for item '${n}': ${e.icon}. Falling back to default icon.`)}}else o==="url"?f=new h.ThemeIcon("globe"):o==="script"&&(f=new h.ThemeIcon("run"));let t=new O(d,h.TreeItemCollapsibleState.None);if(t.id=n,t.tooltip=g,t.iconPath=f,o==="file"&&r){let s=this.resolveFsPath(r),c=h.Uri.file(s),u=s.toLowerCase().endsWith(".md");if(t.contextValue=u?"projectExplorer.doc":"projectExplorer.file",f||(t.iconPath=c),u&&!(e.icon&&e.icon.startsWith("projectExplorer:"))){if(e.icon&&!this.parseCodicon(e.icon)){let m=this.resolveThemedPair(e.icon);m&&(t.iconPath=m)}}u?h.workspace.getConfiguration("project-explorer").get("openDocsInPreview",!0)?t.command={command:"markdown.showPreview",title:"Open Preview",arguments:[c]}:t.command={command:"vscode.open",title:"Open File",arguments:[c]}:t.command={command:"vscode.open",title:"Open File",arguments:[c]}}else if(o==="folder"&&r){let s=h.Uri.file(this.resolveFsPath(r));t.command={command:"revealInExplorer",title:"Reveal in Explorer",arguments:[s]},f||(t.iconPath=new h.ThemeIcon("folder")),t.contextValue="projectExplorer.folder"}else o==="url"&&r?(t.command={command:"projectExplorer.openExternal",title:"Open in Browser",arguments:[r]},t.contextValue="projectExplorer.url",e.icon||this.favicons.getIconForUrl(r).then(s=>{if(s){let c=this.items.get(n);c&&(c.iconPath=s,this._onDidChangeTreeData.fire(c))}}).catch(()=>{})):o==="script"&&r&&(t.script={cmd:r,cwd:e.cwd,env:e.env},t.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[n]},t.contextValue="projectExplorer.script");return!o&&!f&&(t.iconPath=new h.ThemeIcon("folder")),e.additionalContextMenuItems&&(t.additionalContextMenuItems=e.additionalContextMenuItems),t}async runScriptById(e){var u,y;let n=this.items.get(e);if(!n||!n.script||this.running.has(e))return;let o=n.label;this.running.add(e),n.command=void 0,n.label=`${o}...`,this._onDidChangeTreeData.fire(n);let r=n.script.cwd?this.resolveFsPath(n.script.cwd):void 0;if(r&&!b.existsSync(r)){h.window.showErrorMessage(`Invalid cwd for script '${e}': ${r}`),this.running.delete(e),n.label=o,n.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[e]},this._onDidChangeTreeData.fire(n);return}let d={...process.env,...n.script.env||{}},f=(0,H.spawn)(n.script.cmd,{shell:!0,cwd:r,env:d}),g="",t="";(u=f.stdout)==null||u.on("data",m=>{g+=m instanceof Buffer?m.toString("utf8"):String(m)}),(y=f.stderr)==null||y.on("data",m=>{t+=m instanceof Buffer?m.toString("utf8"):String(m)});let s=!1,c=(m,p)=>{if(!s)if(s=!0,m){let v=(p??g).trim();h.window.showInformationMessage(v.length>0?v:`Script '${e}' completed successfully.`)}else{let v=(p??t).trim();h.window.showErrorMessage(v.length>0?v:`Script '${e}' failed.`)}this.running.delete(e),n.label=o,n.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[e]},this._onDidChangeTreeData.fire(n)};f.on("error",m=>{c(!1,`Failed to start script '${e}': ${m instanceof Error?m.message:String(m)}`)}),f.on("close",m=>{c(m===0)})}readTreeItemsFromFile(){try{if(this.treeFileUri){let e=this.treeFileUri.fsPath;if(b.existsSync(e)){let n=b.readFileSync(e,"utf8"),o=JSON.parse(n);return Array.isArray(o)?o:[]}}}catch{}return[]}parseCodicon(e){let n=/^\$\(([^)]+)\)$/.exec(e.trim());return n?n[1]:null}resolveThemedPair(e){if(!e)return null;let n=this.resolveFsPath(e),o=C.dirname(n),r=C.basename(n),d=/(.*?)(\.(light_mode|dark_mode))?(\.[a-zA-Z0-9]+)$/.exec(r);if(!d)return null;let f=d[1],g=d[4],t=C.join(o,`${f}.light_mode${g}`),s=C.join(o,`${f}.dark_mode${g}`);return b.existsSync(t)&&b.existsSync(s)?{light:h.Uri.file(t),dark:h.Uri.file(s)}:null}resolveProjectExplorerIcon(e){let n=C.join(__dirname,"..","resources","icons"),o=C.join(n,`${e}.light_mode.png`),r=C.join(n,`${e}.dark_mode.png`);return b.existsSync(o)&&b.existsSync(r)?{light:h.Uri.file(o),dark:h.Uri.file(r)}:null}async fetchRemoteIcon(e,n){try{let o=await this.favicons.getIconForUrl(e);if(o){let r=this.items.get(n);r&&(r.iconPath=o,this._onDidChangeTreeData.fire(r))}}catch{}}resolveFsPath(e){var r;let n=e.trim();if(n.startsWith("~")&&process.env.HOME&&(n=n.replace("~",process.env.HOME)),C.isAbsolute(n))return n;let o=(r=h.workspace.workspaceFolders)==null?void 0:r[0];return o?C.join(o.uri.fsPath,n):n}},O=class extends h.TreeItem{constructor(e,n){super(e,n)}};var M=T(require("vscode")),D=T(require("fs")),$=T(require("path")),V=a=>{try{D.mkdirSync(a,{recursive:!0})}catch{}},re=(a,e)=>{let n=`${a}.tmp`;D.writeFileSync(n,JSON.stringify(e,null,2),"utf8"),D.renameSync(n,a)};function Z(a){var m;let e=(m=M.workspace.workspaceFolders)==null?void 0:m[0],n=$.join((e==null?void 0:e.uri.fsPath)||"",".vscode","project_explorer");e&&V(n);let o=e?$.join(n,"parser_output.json"):"",r,d=()=>{r&&clearTimeout(r),r=setTimeout(y,150)},f=M.workspace.onDidChangeConfiguration(p=>{(p.affectsConfiguration("project-explorer.watchThese")||p.affectsConfiguration("project-explorer.userDefinedTreeItems")||p.affectsConfiguration("project-explorer.treeItems"))&&d()}),g=[],t=p=>{if(!e)return;let j=($.isAbsolute(p)?p:$.join(e.uri.fsPath,p)).replace(/\\/g,"/"),w=new M.RelativePattern(e,$.relative(e.uri.fsPath,j)+"/**"),i=M.workspace.createFileSystemWatcher(w);g.push(i),i.onDidChange(d),i.onDidCreate(d),i.onDidDelete(d)},s=p=>{try{let v=D.readFileSync(p,"utf8"),j=/^#\s+(.+)$/m.exec(v);return j?j[1].trim():""}catch{return""}},c=p=>{let v=D.existsSync(p)?D.statSync(p):void 0;if(!v)return{path:u(p),type:"resource",title:"",children:[]};if(v.isDirectory()){let j=[];for(let w of D.readdirSync(p)){if(w.startsWith(".")||w==="node_modules"||w==="__pycache__"||w===".DS_Store"||w==="Thumbs.db"||w==="desktop.ini"||w.endsWith(".tmp")||w.endsWith(".temp"))continue;let i=$.join(p,w);j.push(c(i))}return{path:u(p),type:"folder",title:"",children:j}}return p.toLowerCase().endsWith(".md")?{path:u(p),type:"doc",title:s(p),children:[]}:{path:u(p),type:"resource",title:"",children:[]}},u=p=>e?$.relative(e.uri.fsPath,p):p,y=()=>{var i;let p=M.workspace.getConfiguration("project-explorer"),v=p.get("watchThese")||[],j=(p.get("userDefinedTreeItems")||p.get("treeItems")||[]).filter(Boolean),w={};if(j.length>0&&(w.userDefined=j),e){for(;g.length;)(i=g.pop())==null||i.dispose();let I={};for(let x of v)if(!(!x||typeof x!="object")&&x.type==="docs"&&typeof x.path=="string"&&x.path.trim()){let A=$.isAbsolute(x.path)?x.path:$.join(e.uri.fsPath,x.path);t(x.path),I[x.path]=c(A)}Object.keys(I).length>0&&(w.docs=I),V(n),re(o,w)}};return e&&y(),a.subscriptions.push(f),{dispose(){var p;for(;g.length;)(p=g.pop())==null||p.dispose();r&&clearTimeout(r)}}}var _=T(require("vscode")),F=T(require("fs")),U=T(require("path"));function oe(a){if(!a)return[];let e=a.replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu,"");return e?(e=e.replace(/(\p{Ll})(\p{Lu})/gu,"$1 $2"),e=e.replace(/(\p{Lu})(\p{Lu}\p{Ll})/gu,"$1 $2"),e=e.replace(/(\p{N})(\p{L})/gu,(o,r,d)=>r==="3"&&d==="D"?o:r+" "+d),e=e.replace(/(\p{L})(\p{N})/gu,"$1 $2"),e.split(/[^\p{L}\p{N}]+/u).filter(o=>o.length>0)):[]}function W(a){if(!a)return"";let e=oe(a),n=[];for(let o=0;o<e.length;o++){let r=e[o],d=e[o+1];if(d&&/^\d+$/.test(r)&&/^[a-zA-Z]$/.test(d)){n.push(r+d.toUpperCase()),o++;continue}let f=e[o+2];if(d&&f&&/^\d+$/.test(f)){let g=r.toLowerCase();if(["api","html","xml","css","js","ts"].includes(g)&&d.toLowerCase()==="v"){n.push(r.toUpperCase()),n.push(d.toUpperCase()+f),o+=2;continue}}n.push(r)}return n.map(o=>{if(/^\d+[a-zA-Z]+$/.test(o))return o.toUpperCase();if(/^[a-zA-Z]+\d+$/.test(o)){let d=o.toLowerCase(),f=d.replace(/\d+$/,"");return["html","xml","css","js","ts","api"].includes(f)?o.toUpperCase():d.charAt(0).toUpperCase()+d.slice(1)}let r=o.toLowerCase();return["html","xml","css","js","ts","http","url"].includes(r)?o.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1)}).join(" ")}var ie=a=>{try{F.mkdirSync(a,{recursive:!0})}catch{}},ce=(a,e)=>{let n=`${a}.tmp`;F.writeFileSync(n,JSON.stringify(e,null,2),"utf8"),F.renameSync(n,a)};function K(a){var s;let e=(s=_.workspace.workspaceFolders)==null?void 0:s[0];if(!e)return{dispose(){}};let n=e.uri.fsPath,o=U.join(n,".vscode","project_explorer"),r=U.join(o,"parser_output.json"),d=U.join(o,"tree_items.json");ie(o);let f=new _.RelativePattern(e,".vscode/project_explorer/parser_output.json"),g=_.workspace.createFileSystemWatcher(f),t=()=>{let c;try{let i=F.readFileSync(r,"utf8");c=JSON.parse(i)}catch{return}if(!c)return;let u=[],y=new Set;if(Array.isArray(c.userDefined))for(let i of c.userDefined)!i||typeof i!="object"||typeof i.id!="string"||!i.id||y.has(i.id)||(y.add(i.id),u.push({id:i.id,typeAndPath:i.typeAndPath,icon:i.icon,label:i.label,parentId:i.parentId,cwd:i.cwd,env:i.env}));let m=c.docs||{},p=(i,I)=>{let x=U.basename(i.path);if(i.type==="folder"){let P=i.children.find(E=>E.type==="doc"&&/README\.md$/i.test(E.path)),S=i.children.find(E=>E.type==="doc"&&U.basename(E.path,".md").toLowerCase()===U.basename(i.path).toLowerCase()),k=P||S;if(k){let E=j(k);v(k,I);for(let z of i.children)z!==k&&p(z,E);return}let B=x;w({id:B,typeAndPath:`folder:${i.path}`,icon:void 0,label:W(x),parentId:I});for(let E of i.children)p(E,B);return}if(i.type==="doc"){v(i,I);return}w({id:x,typeAndPath:`file:${i.path}`,icon:void 0,label:W(x.replace(/\.[^.]+$/,"")),parentId:I})},v=(i,I)=>{let x=j(i),A=i.title&&i.title.trim()?i.title.trim():W(U.basename(i.path,".md"));w({id:x,typeAndPath:`file:${i.path}`,icon:"projectExplorer:doc",label:A,parentId:I,additionalContextMenuItems:{"Open in Preview":"markdown.showPreview","Open in Editor":"vscode.open"}})},j=i=>U.basename(i.path,".md"),w=i=>{!i.id||y.has(i.id)||(y.add(i.id),u.push({id:i.id,typeAndPath:i.typeAndPath,icon:i.icon,label:i.label,parentId:i.parentId||void 0,additionalContextMenuItems:i.additionalContextMenuItems}))};for(let i of Object.keys(m))p(m[i],null);ce(d,u)};return g.onDidCreate(t,null,a.subscriptions),g.onDidChange(t,null,a.subscriptions),g.onDidDelete(()=>{},null,a.subscriptions),F.existsSync(r)&&t(),{dispose(){g.dispose()}}}async function ae(a){var g;let e=new L(a),n=(g=l.workspace.workspaceFolders)==null?void 0:g[0];if(n){let t=l.Uri.joinPath(n.uri,".vscode","project_explorer");await l.workspace.fs.createDirectory(t)}let o=Z(a),r=K(a);l.window.registerTreeDataProvider("projectExplorer",e);let d=l.window.onDidChangeActiveColorTheme(()=>{e.retheme()});a.subscriptions.push(d);let f=()=>{let s=l.workspace.getConfiguration("project-explorer").get("brainstormingDocPath")||"",c=typeof s=="string"&&s.trim().length>0;l.commands.executeCommand("setContext","projectExplorer.hasBrainstorming",c)};f(),a.subscriptions.push(l.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("project-explorer.brainstormingDocPath")||t.affectsConfiguration("project-explorer"))&&f()})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openBrainstormingDoc",async()=>{var c;let s=(l.workspace.getConfiguration("project-explorer").get("brainstormingDocPath")||"").trim();if(!s){l.window.showWarningMessage("No brainstormingDocPath is configured.");return}try{let u;if(s.startsWith("/")||/^[a-zA-Z]:\\/.test(s)||s.startsWith("~")){let p=s.startsWith("~")&&process.env.HOME?s.replace("~",process.env.HOME):s;u=l.Uri.file(p)}else{let p=(c=l.workspace.workspaceFolders)==null?void 0:c[0];if(!p){l.window.showErrorMessage("No workspace is open to resolve a relative brainstormingDocPath.");return}u=l.Uri.joinPath(p.uri,s)}let m=await l.workspace.openTextDocument(u);await l.window.showTextDocument(m,{preview:!1})}catch(u){let y=u instanceof Error?u.message:String(u);l.window.showErrorMessage(`Unable to open brainstorming document: ${y}`)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openExternal",async t=>{try{let s=l.Uri.parse(t);await l.env.openExternal(s)}catch(s){let c=s instanceof Error?s.message:String(s);l.window.showErrorMessage(`Unable to open URL: ${c}`)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.runScript",async t=>{await e.runScriptById(t)})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.showInExplorer",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let s=t.command.arguments[0];await l.commands.executeCommand("revealInExplorer",s)}else l.window.showErrorMessage("No valid item found to reveal in Explorer")}catch(s){let c=s instanceof Error?s.message:String(s);l.window.showErrorMessage(`Failed to show in Explorer: ${c}`)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openInBrowser",async t=>{if(t&&t.command&&t.command.command==="projectExplorer.openExternal"){let s=t.command.arguments[0];await l.commands.executeCommand("projectExplorer.openExternal",s)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openDocInPreview",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let s=t.command.arguments[0];await l.commands.executeCommand("markdown.showPreview",s)}}catch(s){let c=s instanceof Error?s.message:String(s);l.window.showErrorMessage(`Failed to open in preview: ${c}`)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openDocInEditor",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let s=t.command.arguments[0];await l.commands.executeCommand("vscode.open",s)}}catch(s){let c=s instanceof Error?s.message:String(s);l.window.showErrorMessage(`Failed to open in editor: ${c}`)}})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openHelp",async()=>{let t=a.extension.id,s=l.Uri.parse(`vscode:extension/${t}`);await l.commands.executeCommand("vscode.open",s)})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.openSettings",async()=>{var s;(((s=l.workspace.workspaceFolders)==null?void 0:s.length)||0)>0?(await l.commands.executeCommand("workbench.action.openWorkspaceSettings"),await l.commands.executeCommand("workbench.action.openSettings","@ext:ftl-tools.ftl-project-explorer")):(l.window.showInformationMessage("Workspace settings are unavailable. Opening User settings."),await l.commands.executeCommand("workbench.action.openSettings","@ext:ftl-tools.ftl-project-explorer"))})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.configureTreeItems",async()=>{await l.commands.executeCommand("workbench.action.openSettings","project-explorer.treeItems")})),a.subscriptions.push(l.commands.registerCommand("projectExplorer.collapseAll",async()=>{await l.commands.executeCommand("workbench.actions.treeView.projectExplorer.collapseAll")}))}function de(){}0&&(module.exports={activate,deactivate});
//# sourceMappingURL=extension.js.map
