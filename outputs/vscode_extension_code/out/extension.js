"use strict";var te=Object.create;var W=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ie=(c,e)=>()=>(c&&(e=c(c=0)),e);var K=(c,e)=>{for(var s in e)W(c,s,{get:e[s],enumerable:!0})},Z=(c,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of se(e))!re.call(c,n)&&n!==s&&W(c,n,{get:()=>e[n],enumerable:!(r=oe(e,n))||r.enumerable});return c};var T=(c,e,s)=>(s=c!=null?te(ne(c)):{},Z(e||!c||!c.__esModule?W(s,"default",{value:c,enumerable:!0}):s,c)),ce=c=>Z(W({},"__esModule",{value:!0}),c);var q={};K(q,{format:()=>ve,get:()=>B,update:()=>me,watch:()=>ge});var C,J,he,B,me,ge,we,ve,ee=ie(()=>{"use strict";C=T(require("vscode")),J={"ftl-tools.project-explorer.watchThese":[],"ftl-tools.project-explorer.userDefinedTreeItems":[],"ftl-tools.project-explorer.openDocsInPreview":!0,"ftl-tools.project-explorer.brainstormingDocPath":""},he=c=>{var s;return c==="user"?C.ConfigurationTarget.Global:c==="workspace"?C.ConfigurationTarget.Workspace:(((s=C.workspace.workspaceFolders)==null?void 0:s.length)||0)>0?C.ConfigurationTarget.Workspace:C.ConfigurationTarget.Global},B=(c,e)=>{let s=c.split("."),r=s.shift()||"",n=C.workspace.getConfiguration(r),d=s.join(".");return n.get(d)},me=async(c,e,s)=>{let r=c.split("."),n=r.shift()||"",d=C.workspace.getConfiguration(n),p=r.join(".");await d.update(p,e,he(s))},ge=(c,e,s)=>{let r=Array.isArray(c)?c:null,n=r?null:c;(()=>{let m=r||[];if(!r&&n){let t=new Set([...Object.keys(J)]),o=["project-explorer.watchThese","project-explorer.userDefinedTreeItems","project-explorer.treeItems","project-explorer.openDocsInPreview","project-explorer.brainstormingDocPath"];for(let i of o)t.add(`ftl-tools.${i}`);for(let i of t)n.test(i)&&e(i,B(i));return}for(let t of m)e(t,B(t))})();let p=C.workspace.onDidChangeConfiguration(m=>{let t=o=>{let i=o.split("."),u=i.shift()||"",v=i.join(".");return m.affectsConfiguration(`${u}.${v}`)||m.affectsConfiguration(u)};if(r){for(let o of r)t(o)&&e(o,B(o));return}if(n){let o=new Set([...Object.keys(J)]),i=["project-explorer.watchThese","project-explorer.userDefinedTreeItems","project-explorer.treeItems","project-explorer.openDocsInPreview","project-explorer.brainstormingDocPath"];for(let u of i)o.add(`ftl-tools.${u}`);for(let u of o)n.test(u)&&t(u)&&e(u,B(u))}});return{dispose(){p.dispose()}}},we=async()=>{var s;let c=(s=C.workspace.workspaceFolders)==null?void 0:s[0];if(c)return C.Uri.joinPath(c.uri,".vscode","settings.json");let e=process.env.HOME||process.env.USERPROFILE||"";return C.Uri.file(e?`${e}/Library/Application Support/Code/User/settings.json`:"")},ve=async()=>{let c=await we(),e={},s=!0;try{let o=await C.workspace.fs.readFile(c),i=Buffer.from(o).toString("utf8").trim();e=i?JSON.parse(i):{}}catch{s=!1}s||(e={});let r=new Set(Object.keys(e));for(let o of Object.keys(J))r.has(o)||(e[o]=J[o]);let n=Object.keys(e).filter(o=>o.startsWith("ftl-tools.")).sort(),d=Object.keys(e).filter(o=>!o.startsWith("ftl-tools.")),p={};for(let o of n)p[o]=e[o];for(let o of d)p[o]=e[o];let m=JSON.stringify(p,null,2);await C.workspace.fs.createDirectory(C.Uri.joinPath(c,"..")),await C.workspace.fs.writeFile(c,Buffer.from(m,"utf8"));let t=n[0]||null;return{openedUri:c,firstKey:t}}});var be={};K(be,{activate:()=>ye,deactivate:()=>xe});module.exports=ce(be);var l=T(require("vscode"));var h=T(require("vscode")),I=T(require("path")),b=T(require("fs")),ae=T(require("https")),de=T(require("http")),G=require("child_process"),z=class{constructor(e){this.context=e;this.inflight=new Map;this.cacheDir=I.join(e.globalStorageUri.fsPath,"favicons"),this.indexPath=I.join(this.cacheDir,"index.json");try{b.mkdirSync(this.cacheDir,{recursive:!0})}catch{}this.index=this.readIndex()}async getIconForUrl(e){let s;try{let d=new URL(e);if(d.protocol!=="http:"&&d.protocol!=="https:")return;s=`${d.protocol}//${d.host}`}catch{return}let r=this.inflight.get(s);if(r)return r;let n=this.resolve(s,e).finally(()=>this.inflight.delete(s));return this.inflight.set(s,n),n}async resolve(e,s){let r=Date.now(),n=this.index[e];if(n){if(n.expiresAt&&n.expiresAt>r&&n.path&&b.existsSync(n.path))return h.Uri.file(n.path);if(n.negativeUntil&&n.negativeUntil>r)return}let d=`${e}/favicon.ico`,p=await this.tryFetchBuffer(d,5e3).catch(()=>{});if(p){let t=this.saveIcon(e,p,"ico");return this.index[e]={path:t,expiresAt:r+7*24*60*60*1e3},this.writeIndex(),h.Uri.file(t)}let m=await this.tryFetchText(s,5e3).catch(()=>{});if(m){let t=this.findIconHref(m);if(t)try{let o=new URL(s),i=new URL(t,o),u=await this.tryFetchBuffer(i.toString(),7e3).catch(()=>{});if(u){let v=this.guessExtFromUrlOrMime(i.toString()),g=this.saveIcon(e,u,v);return this.index[e]={path:g,expiresAt:r+7*24*60*60*1e3},this.writeIndex(),h.Uri.file(g)}}catch{}}this.index[e]={negativeUntil:r+24*60*60*1e3},this.writeIndex()}readIndex(){try{if(b.existsSync(this.indexPath)){let e=b.readFileSync(this.indexPath,"utf8");return JSON.parse(e)||{}}}catch{}return{}}writeIndex(){try{b.writeFileSync(this.indexPath,JSON.stringify(this.index,null,2),"utf8")}catch{}}saveIcon(e,s,r){let n=e.replace(/[^a-z0-9]/gi,"_"),d=I.join(this.cacheDir,`${n}.${r}`);return b.writeFileSync(d,s),d}guessExtFromUrlOrMime(e){let s=e.toLowerCase();return s.endsWith(".png")?"png":s.endsWith(".svg")||s.includes("image/svg")?"svg":s.endsWith(".jpg")||s.endsWith(".jpeg")?"jpg":s.endsWith(".ico")?"ico":"png"}async tryFetchText(e,s){return(await this.tryFetchBuffer(e,s)).toString("utf8")}async tryFetchBuffer(e,s){return new Promise((r,n)=>{let d=!1,p=setTimeout(()=>{d=!0,o==null||o.destroy(new Error("timeout")),n(new Error("timeout"))},s),o=(new URL(e).protocol==="https:"?ae:de).get(e,i=>{let u=i.statusCode||0;if([301,302,303,307,308].includes(u)&&i.headers.location){clearTimeout(p),this.tryFetchBuffer(new URL(i.headers.location,e).toString(),s).then(r,n),i.resume();return}if(u<200||u>=300){clearTimeout(p),n(new Error(`HTTP ${u}`)),i.resume();return}let v=[];i.on("data",g=>v.push(Buffer.isBuffer(g)?g:Buffer.from(g))),i.on("end",()=>{d||(clearTimeout(p),r(Buffer.concat(v)))}),i.on("error",g=>{d||(clearTimeout(p),n(g))})});o.on("error",i=>{d||(clearTimeout(p),n(i))})})}findIconHref(e){let s=/<link\s+[^>]*rel=["']([^"']*)["'][^>]*href=["']([^"']+)["'][^>]*>/gi,r,n=[];for(;r=s.exec(e);){let d=r[1].toLowerCase(),p=r[2];d.includes("icon")&&n.push(p)}return n[0]}},N=class{constructor(e){this._onDidChangeTreeData=new h.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.items=new Map;this.treeFileUri=null;this.watcher=null;this.parentById=new Map;this.childrenById=new Map;this.roots=[];this.running=new Set;this.scriptIds=new Set;var r;this.favicons=new z(e);let s=(r=h.workspace.workspaceFolders)==null?void 0:r[0];if(s){this.treeFileUri=h.Uri.joinPath(s.uri,".vscode","project_explorer","tree_items.json");let n=new h.RelativePattern(s,".vscode/project_explorer/tree_items.json");this.watcher=h.workspace.createFileSystemWatcher(n),this.watcher.onDidChange(()=>this.refresh()),this.watcher.onDidCreate(()=>this.refresh())}h.workspace.onDidChangeConfiguration(n=>{(n.affectsConfiguration("project-explorer.treeItems")||n.affectsConfiguration("project-explorer"))&&this.refresh()})}refresh(){this.rebuild(),this._onDidChangeTreeData.fire()}retheme(){let e=I.join(__dirname,"..","resources","icons");for(let[s,r]of this.items){let n=r.iconPath;if(n&&typeof n=="object"&&"light"in n&&"dark"in n){let d=String(n.light),p=String(n.dark);if(d.includes("resources/icons")&&p.includes("resources/icons")){let m=d.match(/([^/\\]+)\.light_mode\.(png|svg)$/);if(m){let t=m[1],o=this.resolveProjectExplorerIcon(t);o&&(r.iconPath=o)}}}}this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){return this.items.size===0&&this.roots.length===0&&this.rebuild(),e?(this.childrenById.get(e.id||"")||[]).map(r=>this.items.get(r)).filter(Boolean):this.roots.map(r=>this.items.get(r)).filter(Boolean)}rebuild(){let e=new Set;this.items.clear(),this.parentById.clear(),this.childrenById.clear(),this.roots=[],this.scriptIds.clear();let s=this.readTreeItemsFromFile(),r=[];for(let t of s){if(!t||typeof t!="object"){e.add("Ignored non-object entry in `project-explorer.treeItems`.");continue}let o=typeof t.id=="string"&&t.id.trim()?t.id.trim():"",i=typeof t.typeAndPath=="string"?t.typeAndPath:void 0;if(!o){e.add("Ignored item with missing `id`.");continue}if(this.items.has(o)||r.find(k=>k.id===o)){e.add(`Duplicate id '${o}' found. Only the first occurrence will be used.`);continue}let u=typeof t.parentId=="string"&&t.parentId.trim()?t.parentId.trim():void 0,v=typeof t.label=="string"&&t.label.trim()?t.label.trim():void 0,g=typeof t.icon=="string"&&t.icon.trim()?t.icon.trim():void 0,f,w,P=i,y=t.type_plus_path,a=typeof P=="string"&&P.trim()?P.trim():typeof y=="string"&&y.trim()?y.trim():"";if(!a&&typeof y=="string"&&y.trim()&&e.add(`Item '${o}' uses deprecated 'type_plus_path'. Please rename to 'typeAndPath'.`),a){let k=a.indexOf(":");if(k>0&&k<a.length-1){let D=a.slice(0,k),S=a.slice(k+1);["file","folder","url","script"].includes(D)?(f=D,w=S):e.add(`Item '${o}' has unknown type '${D}'. Treating as label-only item.`)}else e.add(`Item '${o}' has invalid typeAndPath '${a}'. Treating as label-only item.`)}let j=v;if(!j)if(f&&w)if(f==="url")try{let k=new URL(w),D=k.pathname.split("/").filter(Boolean);j=D.length>0?decodeURIComponent(D[D.length-1]):k.hostname}catch{j=w}else f==="file"||f==="folder"?j=I.basename(this.resolveFsPath(w)):f==="script"&&(j=w);else j=o;let x={id:o,type:f,target:w,label:j,icon:g,parentId:u??void 0};if(f==="script"){let k=typeof t.cwd=="string"&&t.cwd.trim()?t.cwd.trim():void 0,D=t.env,S;if(D&&typeof D=="object"&&!Array.isArray(D)){S={};for(let[L,U]of Object.entries(D))typeof U=="string"&&(S[L]=U)}x.cwd=k,x.env=S,this.scriptIds.add(o)}let R=t.additionalContextMenuItems;if(R&&typeof R=="object"&&!Array.isArray(R)){let k={};for(let[D,S]of Object.entries(R))typeof S=="string"&&S.trim()&&(k[D]=S.trim());Object.keys(k).length>0&&(x.additionalContextMenuItems=k)}r.push(x)}for(let t of r){let o=this.makeNode(t);this.items.set(t.id,o),this.parentById.set(t.id,t.parentId||void 0)}for(let[t,o]of Array.from(this.parentById.entries()))o&&this.scriptIds.has(o)&&(e.add(`Item '${t}' cannot have script parent '${o}'. Rendering as top-level.`),this.parentById.set(t,void 0));let n=new Set,d=new Set,p=new Set,m=t=>{if(d.has(t)){p.add(t);return}if(n.has(t))return;n.add(t),d.add(t);let o=this.parentById.get(t);o&&this.items.has(o)&&m(o),d.delete(t)};for(let t of this.items.keys())m(t);p.size>0&&e.add("Detected cyclical parent relationships. Items in cycles will be rendered at top level.");for(let t of p)this.parentById.delete(t);for(let t of this.items.keys())this.childrenById.set(t,[]);for(let[t,o]of this.parentById)o&&this.items.has(o)&&this.childrenById.get(o).push(t);for(let t of this.items.keys()){let o=this.parentById.get(t);(!o||!this.items.has(o))&&(o&&!this.items.has(o)&&e.add(`Parent '${o}' not found for item '${t}'. Rendering as top-level.`),this.roots.push(t))}for(let[t,o]of this.items){let i=(this.childrenById.get(t)||[]).length>0;o.collapsibleState=i?h.TreeItemCollapsibleState.Collapsed:h.TreeItemCollapsibleState.None}e.size>0&&h.window.showWarningMessage(Array.from(e).join(" "))}makeNode(e){let{id:s}=e,r=e.type,n=e.target,d=e.label,p,m=new h.MarkdownString;if(r&&n?m.appendText(`${r}:${n}`):m.appendText(d),m.isTrusted=!0,e.icon){let o=this.parseCodicon(e.icon);if(o)p=new h.ThemeIcon(o);else if(e.icon.startsWith("projectExplorer:")){let i=e.icon.substring(16),u=this.resolveProjectExplorerIcon(i);u?p=u:h.window.showWarningMessage(`Project Explorer icon not found: ${i}. Falling back to default icon.`)}else if(e.icon.startsWith("local:")){let i=e.icon.substring(6),u=this.resolveFsPath(i);b.existsSync(u)?p=h.Uri.file(u):h.window.showWarningMessage(`Local icon not found for item '${s}': ${i}. Falling back to default icon.`)}else if(e.icon.startsWith("vscode:")){let i=e.icon.substring(7);p=new h.ThemeIcon(i)}else if(e.icon.startsWith("remote:")){let i=e.icon.substring(7);this.fetchRemoteIcon(i,s).catch(()=>{})}else{let i=this.resolveFsPath(e.icon);b.existsSync(i)?p=h.Uri.file(i):h.window.showWarningMessage(`Icon path not found for item '${s}': ${e.icon}. Falling back to default icon.`)}}else r==="url"?p=new h.ThemeIcon("globe"):r==="script"&&(p=new h.ThemeIcon("run"));let t=new H(d,h.TreeItemCollapsibleState.None);if(t.id=s,t.tooltip=m,t.iconPath=p,r==="file"&&n){let o=this.resolveFsPath(n),i=h.Uri.file(o),u=o.toLowerCase().endsWith(".md");if(t.contextValue=u?"projectExplorer.doc":"projectExplorer.file",p||(t.iconPath=i),u&&!(e.icon&&e.icon.startsWith("projectExplorer:"))){if(e.icon&&!this.parseCodicon(e.icon)){let g=this.resolveThemedPair(e.icon);g&&(t.iconPath=g)}}u?h.workspace.getConfiguration("project-explorer").get("openDocsInPreview",!0)?t.command={command:"markdown.showPreview",title:"Open Preview",arguments:[i]}:t.command={command:"vscode.open",title:"Open File",arguments:[i]}:t.command={command:"vscode.open",title:"Open File",arguments:[i]}}else if(r==="folder"&&n){let o=h.Uri.file(this.resolveFsPath(n));t.command={command:"revealInExplorer",title:"Reveal in Explorer",arguments:[o]},p||(t.iconPath=new h.ThemeIcon("folder")),t.contextValue="projectExplorer.folder"}else r==="url"&&n?(t.command={command:"projectExplorer.openExternal",title:"Open in Browser",arguments:[n]},t.contextValue="projectExplorer.url",e.icon||this.favicons.getIconForUrl(n).then(o=>{if(o){let i=this.items.get(s);i&&(i.iconPath=o,this._onDidChangeTreeData.fire(i))}}).catch(()=>{})):r==="script"&&n&&(t.script={cmd:n,cwd:e.cwd,env:e.env},t.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[s]},t.contextValue="projectExplorer.script");return!r&&!p&&(t.iconPath=new h.ThemeIcon("folder")),e.additionalContextMenuItems&&(t.additionalContextMenuItems=e.additionalContextMenuItems),t}async runScriptById(e){var u,v;let s=this.items.get(e);if(!s||!s.script||this.running.has(e))return;let r=s.label;this.running.add(e),s.command=void 0,s.label=`${r}...`,this._onDidChangeTreeData.fire(s);let n=s.script.cwd?this.resolveFsPath(s.script.cwd):void 0;if(n&&!b.existsSync(n)){h.window.showErrorMessage(`Invalid cwd for script '${e}': ${n}`),this.running.delete(e),s.label=r,s.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[e]},this._onDidChangeTreeData.fire(s);return}let d={...process.env,...s.script.env||{}},p=(0,G.spawn)(s.script.cmd,{shell:!0,cwd:n,env:d}),m="",t="";(u=p.stdout)==null||u.on("data",g=>{m+=g instanceof Buffer?g.toString("utf8"):String(g)}),(v=p.stderr)==null||v.on("data",g=>{t+=g instanceof Buffer?g.toString("utf8"):String(g)});let o=!1,i=(g,f)=>{if(!o)if(o=!0,g){let w=(f??m).trim();h.window.showInformationMessage(w.length>0?w:`Script '${e}' completed successfully.`)}else{let w=(f??t).trim();h.window.showErrorMessage(w.length>0?w:`Script '${e}' failed.`)}this.running.delete(e),s.label=r,s.command={command:"projectExplorer.runScript",title:"Run Script",arguments:[e]},this._onDidChangeTreeData.fire(s)};p.on("error",g=>{i(!1,`Failed to start script '${e}': ${g instanceof Error?g.message:String(g)}`)}),p.on("close",g=>{i(g===0)})}readTreeItemsFromFile(){try{if(this.treeFileUri){let e=this.treeFileUri.fsPath;if(b.existsSync(e)){let s=b.readFileSync(e,"utf8"),r=JSON.parse(s);return Array.isArray(r)?r:[]}}}catch{}return[]}parseCodicon(e){let s=/^\$\(([^)]+)\)$/.exec(e.trim());return s?s[1]:null}resolveThemedPair(e){if(!e)return null;let s=this.resolveFsPath(e),r=I.dirname(s),n=I.basename(s),d=/(.*?)(\.(light_mode|dark_mode))?(\.[a-zA-Z0-9]+)$/.exec(n);if(!d)return null;let p=d[1],m=d[4],t=I.join(r,`${p}.light_mode${m}`),o=I.join(r,`${p}.dark_mode${m}`);return b.existsSync(t)&&b.existsSync(o)?{light:h.Uri.file(t),dark:h.Uri.file(o)}:null}resolveProjectExplorerIcon(e){let s=I.join(__dirname,"..","resources","icons"),r=I.join(s,`${e}.light_mode.png`),n=I.join(s,`${e}.dark_mode.png`);return b.existsSync(r)&&b.existsSync(n)?{light:h.Uri.file(r),dark:h.Uri.file(n)}:null}async fetchRemoteIcon(e,s){try{let r=await this.favicons.getIconForUrl(e);if(r){let n=this.items.get(s);n&&(n.iconPath=r,this._onDidChangeTreeData.fire(n))}}catch{}}resolveFsPath(e){var n;let s=e.trim();if(s.startsWith("~")&&process.env.HOME&&(s=s.replace("~",process.env.HOME)),I.isAbsolute(s))return s;let r=(n=h.workspace.workspaceFolders)==null?void 0:n[0];return r?I.join(r.uri.fsPath,s):s}},H=class extends h.TreeItem{constructor(e,s){super(e,s)}};var _=T(require("vscode")),E=T(require("fs")),$=T(require("path")),Q=c=>{try{E.mkdirSync(c,{recursive:!0})}catch{}},pe=(c,e)=>{let s=`${c}.tmp`;E.writeFileSync(s,JSON.stringify(e,null,2),"utf8"),E.renameSync(s,c)};function X(c){var g;let e=(g=_.workspace.workspaceFolders)==null?void 0:g[0],s=$.join((e==null?void 0:e.uri.fsPath)||"",".vscode","project_explorer");e&&Q(s);let r=e?$.join(s,"parser_output.json"):"",n,d=()=>{n&&clearTimeout(n),n=setTimeout(v,150)},p=_.workspace.onDidChangeConfiguration(f=>{(f.affectsConfiguration("project-explorer.watchThese")||f.affectsConfiguration("project-explorer.userDefinedTreeItems")||f.affectsConfiguration("project-explorer.treeItems"))&&d()}),m=[],t=f=>{if(!e)return;let P=($.isAbsolute(f)?f:$.join(e.uri.fsPath,f)).replace(/\\/g,"/"),y=new _.RelativePattern(e,$.relative(e.uri.fsPath,P)+"/**"),a=_.workspace.createFileSystemWatcher(y);m.push(a),a.onDidChange(d),a.onDidCreate(d),a.onDidDelete(d)},o=f=>{try{let w=E.readFileSync(f,"utf8"),P=/^#\s+(.+)$/m.exec(w);return P?P[1].trim():""}catch{return""}},i=f=>{let w=E.existsSync(f)?E.statSync(f):void 0;if(!w)return{path:u(f),type:"resource",title:"",children:[]};if(w.isDirectory()){let P=[];for(let y of E.readdirSync(f)){if(y.startsWith(".")||y==="node_modules"||y==="__pycache__"||y===".DS_Store"||y==="Thumbs.db"||y==="desktop.ini"||y.endsWith(".tmp")||y.endsWith(".temp"))continue;let a=$.join(f,y);P.push(i(a))}return{path:u(f),type:"folder",title:"",children:P}}return f.toLowerCase().endsWith(".md")?{path:u(f),type:"doc",title:o(f),children:[]}:{path:u(f),type:"resource",title:"",children:[]}},u=f=>e?$.relative(e.uri.fsPath,f):f,v=()=>{var a;let f=_.workspace.getConfiguration("project-explorer"),w=f.get("watchThese")||[],P=(f.get("userDefinedTreeItems")||f.get("treeItems")||[]).filter(Boolean),y={};if(P.length>0&&(y.userDefined=P),e){for(;m.length;)(a=m.pop())==null||a.dispose();let j={};for(let x of w)if(!(!x||typeof x!="object")&&x.type==="docs"&&typeof x.path=="string"&&x.path.trim()){let R=$.isAbsolute(x.path)?x.path:$.join(e.uri.fsPath,x.path);t(x.path),j[x.path]=i(R)}Object.keys(j).length>0&&(y.docs=j),Q(s),pe(r,y)}};return e&&v(),c.subscriptions.push(p),{dispose(){var f;for(;m.length;)(f=m.pop())==null||f.dispose();n&&clearTimeout(n)}}}var M=T(require("vscode")),A=T(require("fs")),F=T(require("path"));function le(c){if(!c)return[];let e=c.replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu,"");return e?(e=e.replace(/(\p{Ll})(\p{Lu})/gu,"$1 $2"),e=e.replace(/(\p{Lu})(\p{Lu}\p{Ll})/gu,"$1 $2"),e=e.replace(/(\p{N})(\p{L})/gu,(r,n,d)=>n==="3"&&d==="D"?r:n+" "+d),e=e.replace(/(\p{L})(\p{N})/gu,"$1 $2"),e.split(/[^\p{L}\p{N}]+/u).filter(r=>r.length>0)):[]}function O(c){if(!c)return"";let e=le(c),s=[];for(let r=0;r<e.length;r++){let n=e[r],d=e[r+1];if(d&&/^\d+$/.test(n)&&/^[a-zA-Z]$/.test(d)){s.push(n+d.toUpperCase()),r++;continue}let p=e[r+2];if(d&&p&&/^\d+$/.test(p)){let m=n.toLowerCase();if(["api","html","xml","css","js","ts"].includes(m)&&d.toLowerCase()==="v"){s.push(n.toUpperCase()),s.push(d.toUpperCase()+p),r+=2;continue}}s.push(n)}return s.map(r=>{if(/^\d+[a-zA-Z]+$/.test(r))return r.toUpperCase();if(/^[a-zA-Z]+\d+$/.test(r)){let d=r.toLowerCase(),p=d.replace(/\d+$/,"");return["html","xml","css","js","ts","api"].includes(p)?r.toUpperCase():d.charAt(0).toUpperCase()+d.slice(1)}let n=r.toLowerCase();return["html","xml","css","js","ts","http","url"].includes(n)?r.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)}).join(" ")}var fe=c=>{try{A.mkdirSync(c,{recursive:!0})}catch{}},ue=(c,e)=>{let s=`${c}.tmp`;A.writeFileSync(s,JSON.stringify(e,null,2),"utf8"),A.renameSync(s,c)};function Y(c){var o;let e=(o=M.workspace.workspaceFolders)==null?void 0:o[0];if(!e)return{dispose(){}};let s=e.uri.fsPath,r=F.join(s,".vscode","project_explorer"),n=F.join(r,"parser_output.json"),d=F.join(r,"tree_items.json");fe(r);let p=new M.RelativePattern(e,".vscode/project_explorer/parser_output.json"),m=M.workspace.createFileSystemWatcher(p),t=()=>{let i;try{let a=A.readFileSync(n,"utf8");i=JSON.parse(a)}catch{return}if(!i)return;let u=[],v=new Set;if(Array.isArray(i.userDefined))for(let a of i.userDefined)!a||typeof a!="object"||typeof a.id!="string"||!a.id||v.has(a.id)||(v.add(a.id),u.push({id:a.id,typeAndPath:a.typeAndPath,icon:a.icon,label:a.label,parentId:a.parentId,cwd:a.cwd,env:a.env}));let g=i.docs||{},f=(a,j)=>{let x=F.basename(a.path);if(a.type==="folder"){let k=a.children.find(U=>U.type==="doc"&&/README\.md$/i.test(U.path)),D=a.children.find(U=>U.type==="doc"&&F.basename(U.path,".md").toLowerCase()===F.basename(a.path).toLowerCase()),S=k||D;if(S){let U=P(S);w(S,j);for(let V of a.children)V!==S&&f(V,U);return}let L=x;y({id:L,typeAndPath:`folder:${a.path}`,icon:void 0,label:O(x),parentId:j});for(let U of a.children)f(U,L);return}if(a.type==="doc"){w(a,j);return}y({id:x,typeAndPath:`file:${a.path}`,icon:void 0,label:O(x.replace(/\.[^.]+$/,"")),parentId:j})},w=(a,j)=>{let x=P(a),R=a.title&&a.title.trim()?a.title.trim():O(F.basename(a.path,".md"));y({id:x,typeAndPath:`file:${a.path}`,icon:"projectExplorer:doc",label:R,parentId:j,additionalContextMenuItems:{"Open in Preview":"markdown.showPreview","Open in Editor":"vscode.open"}})},P=a=>F.basename(a.path,".md"),y=a=>{!a.id||v.has(a.id)||(v.add(a.id),u.push({id:a.id,typeAndPath:a.typeAndPath,icon:a.icon,label:a.label,parentId:a.parentId||void 0,additionalContextMenuItems:a.additionalContextMenuItems}))};for(let a of Object.keys(g))f(g[a],null);ue(d,u)};return m.onDidCreate(t,null,c.subscriptions),m.onDidChange(t,null,c.subscriptions),m.onDidDelete(()=>{},null,c.subscriptions),A.existsSync(n)&&t(),{dispose(){m.dispose()}}}async function ye(c){var m;let e=new N(c),s=(m=l.workspace.workspaceFolders)==null?void 0:m[0];if(s){let t=l.Uri.joinPath(s.uri,".vscode","project_explorer");await l.workspace.fs.createDirectory(t)}let r=X(c),n=Y(c);l.window.registerTreeDataProvider("projectExplorer",e);let d=l.window.onDidChangeActiveColorTheme(()=>{e.retheme()});c.subscriptions.push(d);let p=()=>{let o=l.workspace.getConfiguration("project-explorer").get("brainstormingDocPath")||"",i=typeof o=="string"&&o.trim().length>0;l.commands.executeCommand("setContext","projectExplorer.hasBrainstorming",i)};p(),c.subscriptions.push(l.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("project-explorer.brainstormingDocPath")||t.affectsConfiguration("project-explorer"))&&p()})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openBrainstormingDoc",async()=>{var i;let o=(l.workspace.getConfiguration("project-explorer").get("brainstormingDocPath")||"").trim();if(!o){l.window.showWarningMessage("No brainstormingDocPath is configured.");return}try{let u;if(o.startsWith("/")||/^[a-zA-Z]:\\/.test(o)||o.startsWith("~")){let f=o.startsWith("~")&&process.env.HOME?o.replace("~",process.env.HOME):o;u=l.Uri.file(f)}else{let f=(i=l.workspace.workspaceFolders)==null?void 0:i[0];if(!f){l.window.showErrorMessage("No workspace is open to resolve a relative brainstormingDocPath.");return}u=l.Uri.joinPath(f.uri,o)}let g=await l.workspace.openTextDocument(u);await l.window.showTextDocument(g,{preview:!1})}catch(u){let v=u instanceof Error?u.message:String(u);l.window.showErrorMessage(`Unable to open brainstorming document: ${v}`)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openExternal",async t=>{try{let o=l.Uri.parse(t);await l.env.openExternal(o)}catch(o){let i=o instanceof Error?o.message:String(o);l.window.showErrorMessage(`Unable to open URL: ${i}`)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.runScript",async t=>{await e.runScriptById(t)})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.showInExplorer",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let o=t.command.arguments[0];await l.commands.executeCommand("revealInExplorer",o)}else l.window.showErrorMessage("No valid item found to reveal in Explorer")}catch(o){let i=o instanceof Error?o.message:String(o);l.window.showErrorMessage(`Failed to show in Explorer: ${i}`)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openInBrowser",async t=>{if(t&&t.command&&t.command.command==="projectExplorer.openExternal"){let o=t.command.arguments[0];await l.commands.executeCommand("projectExplorer.openExternal",o)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openDocInPreview",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let o=t.command.arguments[0];await l.commands.executeCommand("markdown.showPreview",o)}}catch(o){let i=o instanceof Error?o.message:String(o);l.window.showErrorMessage(`Failed to open in preview: ${i}`)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openDocInEditor",async t=>{try{if(t&&t.command&&t.command.arguments&&t.command.arguments[0]){let o=t.command.arguments[0];await l.commands.executeCommand("vscode.open",o)}}catch(o){let i=o instanceof Error?o.message:String(o);l.window.showErrorMessage(`Failed to open in editor: ${i}`)}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openHelp",async()=>{let t=c.extension.id,o=l.Uri.parse(`vscode:extension/${t}`);await l.commands.executeCommand("vscode.open",o)})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.openSettings",async()=>{let t=await Promise.resolve().then(()=>(ee(),q)),{openedUri:o,firstKey:i}=await t.format(),u=await l.workspace.openTextDocument(o),v=await l.window.showTextDocument(u,{preview:!1});if(i){let f=u.getText().indexOf(`"${i}"`);if(f>=0){let w=u.positionAt(f+1);v.revealRange(new l.Range(w,w),l.TextEditorRevealType.InCenter),v.selection=new l.Selection(w,w)}}})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.configureTreeItems",async()=>{await l.commands.executeCommand("workbench.action.openSettings","project-explorer.treeItems")})),c.subscriptions.push(l.commands.registerCommand("projectExplorer.collapseAll",async()=>{await l.commands.executeCommand("workbench.actions.treeView.projectExplorer.collapseAll")}))}function xe(){}0&&(module.exports={activate,deactivate});
//# sourceMappingURL=extension.js.map
